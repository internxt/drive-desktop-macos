# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane


default_platform(:mac)


platform :mac do
  desc "Build release from CI"
  lane :release_ci do

    
    # Prepare certificates using Match
    match(
      type: "developer_id", 
      readonly: true,
      app_identifier: [
        "internxt.InternxtDesktop", 
        "internxt.InternxtDesktop.sync"
      ],
      clone_branch_directly: true
    )

    # Build, archive and sign the .app
    build_mac_app(
      clean: true,
      output_directory: 'build',
      export_method: "developer-id",
      scheme: "InternxtDesktop",
      xcargs: '-allowProvisioningUpdates PROVISIONING_PROFILE_SPECIFIER=match Direct internxt.InternxtDesktop macos'
    )


    # Notarize the app sending it to Apple notarytool
    notarize(
      package: './build/Internxt Drive.app',
      api_key_path: './app_store_key.json'
    )
    
  end
end
